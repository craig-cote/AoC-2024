
namespace Challenges
{
	//    Start:  9:00pm
	//    Break:  9:14pm
	//     Back:  9:30pm
	// A Solved: 11:20pm  Damn multidimensional arrays! :D
	// B solved: 00:00pm

	public class Day6
	{
		private const string Example = "....#.....\r\n.........#\r\n..........\r\n..#.......\r\n.......#..\r\n..........\r\n.#..^.....\r\n........#.\r\n#.........\r\n......#...";
		private const string Data = ".........#...................................................................................................#.................#..\r\n...........................#.......................................#..............................................................\r\n.............#.................................................................................#............................#.....\r\n...#.....................#.......#....................................#..............#.............................#...........#.#\r\n..........#.....#..#.....#.............#..................#............#.....#........#.#.......#............................#....\r\n...#...................#..........#...................#.........#..#..............##.......................................#......\r\n..................................................................................................#...............................\r\n...............#.........#....#.#..#.........#...........#...#....................#.........#.......#....#........................\r\n..........................................#......#.#...................................................#.............#............\r\n....................#............................#..........................................#.....................#.........#.....\r\n..............#..................................#................#..#...........................................#................\r\n.........#....###.......#........................................................................................#.#.....#...#..#.\r\n.#....................................#.....................................#.................................#..................#\r\n........................#...................................#.#....................#......##.#.........#..........................\r\n............#.......#..................#..........................................................................................\r\n....#.............#.#.....#...#.....#......................#...............#............##...#....................................\r\n...#....#.....................................##........#........#....##.....................................#....................\r\n...........................................................................#........#..........##................................#\r\n..............................#.#......................#..........................#..#........#...............................#...\r\n..............#.........###.......................................#...........#...............#......#.........#........#.....#...\r\n............#............................#....................#........................#............#.............................\r\n.........................................#.....................................................#.....#...............#............\r\n.#...##.......................#.......#..........................................................................#...#...........#\r\n....#..............#............#......#........................#.......................#...#.......................#.............\r\n.......#...............#......#......#..........................................#..................#....................#...#.....\r\n.......................................................................#.........#................................................\r\n.#.......#........................................................##..............................................................\r\n.........................#...................#..#......##..................................#......#......#........................\r\n......................................#..............................................#......#..........#.#.........#..............\r\n.....#..............#..#........#..............................#...##.............................................................\r\n..##............................#.......................................................#..........#..............................\r\n...........................................................##................................................#....................\r\n#...............#.........#.....................................................#......................###........................\r\n#.#.......................#........................#..#.....................#....#........#........................#...#.........#\r\n............#.............#.#............#........................#..........#....................................................\r\n............#...................#.....................................................................................#.......#...\r\n.............................#...#..#...........................#...#.........................................................#...\r\n........#.......................##..........................................................#.........#.....................#.....\r\n............##............#..........................................................#.#.....#......#.#.......#...................\r\n...........#.....#......#.................#.............#......................................#.....#...#........................\r\n#............#.........#.......##.....#......#...........#...........#.......#................#...................................\r\n......#..#...#.....#................................................#............#...#..........^.................................\r\n............................................................................................................#....#................\r\n......................................#.............................#........................#...............#.....#...#..........\r\n...#.........................................................................#....................................................\r\n.....................................#.........................................................#.............#.........#..........\r\n#..............................#...#.................................#............................................................\r\n..........#..................#............#.......#...........................#...................#.....#.........................\r\n............................#...##.............................................................#............#.....................\r\n.................#..................................................................#..#..............#...........................\r\n..................#...............................#................#............#...........#......#............#.................\r\n.....#......................#..............#.......................#......................#.......................................\r\n...............................#.....#.......................#.......#......................#......#............#...........#.....\r\n......#.............##....#.....#...............#.....#............................#....................................#.........\r\n...#.#.......#..#...##.............................................................#.#.#...........#.....#................#.......\r\n...........................................#...#......#...........................................................................\r\n.........#.................................#........................................................................#........#.#..\r\n........................#..........................................#.......#..............#.......................................\r\n....................................................#...............#..........................#..................................\r\n............................#................#......#...............#.....................#.......................................\r\n#.#............#......................................................................................#.....#.....................\r\n................................................................#....#..........................................#........#......#.\r\n.......#........#......................................................................#.................#..................#.#...\r\n...............................#...#......................................................................#.........#.........#...\r\n...........#..#..................##..#.........................................#..............##............................#.....\r\n#........#...............#.....#.....#.................#............#....#.............................#.......#.................#\r\n...............#...................................................#.......#.......................#......#.............#.........\r\n...#............................................................................................................................#.\r\n#.....................#......................................................#...........................................#........\r\n...........#..........................................#.......................................#.....................#.............\r\n....#.##.......#..............#.....#..............................#....................................#.....................#...\r\n...............................................................................................................#...............#..\r\n.#...........................#...#.....#...#...................#....#........#.........#................................#.........\r\n.................#............................................................................#........................#..#.......\r\n.............#....#.....................................................#............#.........................#.......#..........\r\n#....#........................#....................................................................##.............................\r\n...#.#.....................................#...............................................#.....................#....#.........#.\r\n.........#..............................#....................................#.................#............#.....................\r\n................................................................#.................................................................\r\n#.......#..............................................#.............................#...........#................................\r\n.#......#.........#.............................#...............................................................#.................\r\n.........#.....#......#.......................................................................................................#...\r\n#..............................#........#............................#.................................#.....#.....#..............\r\n......#.....................................#.......#........#....................................................................\r\n#.......#.....................................#......................................................................#............\r\n.....................................#......................................#......#.##..................#.....#.#................\r\n.......................#.........#......#...........................................................................##............\r\n.....#......#.#.................................................#.............................#............#.#.......#............\r\n..................#.......................................#.#.............................#..................................#....\r\n......................#.......#.....................#...................#......#.........................................#........\r\n.........#...................................................................................................#....#...............\r\n.........................#...........#..........#...............#.....#...................................................##......\r\n#...#......#.#.....................#..................#.................#..................#......................................\r\n..............................#.....#................#.....................#............#...#....#............#...#...............\r\n.........................#..................#.............................................................................#.......\r\n.......#....................#.......................#.....................#..........#...........#..........#...................#.\r\n....#..........#..#................#.....#..........#........#..................#.....................##...............#.........#\r\n.....................................................................................#......................................#.....\r\n.......................................#...................................#.......................#..........................#...\r\n.......#...............................#............#.....#..............................................#.................#......\r\n.#..........................#..................................................................#...#.#.......#.#..........#.......\r\n#...............................................................#.#............................#...............#......#...........\r\n...#..........................#.#..#.#.............................................................#......#.......................\r\n..................#........#.....................................................#...............................................#\r\n....................#.............#.........#........##................#.............#............#..#............................\r\n.........................#.................................#...........................................#.....#....................\r\n..........................................##..........#................................#........................................#.\r\n.................................................................................#..........#....................##........##.....\r\n.....###......#.....#...................................................................................#..#...................#..\r\n........#.....#.....#.....#..........#.................................................#.#......................#.................\r\n...........................................#....#..............#..#..............#................................................\r\n....#.............#...................................#.....#........................................................#............\r\n.........#........#.............#..................#..........#..........................###.......#....#.#.#.....................\r\n..................#....................#...................#...#..................................................................\r\n.......#...............#................................................................................#................#........\r\n....#..........................#......#....................................#.............#...#......................#...#.........\r\n.#..#....................#.....................#.............#...............................#....................#....##.........\r\n..#..#........#......#.................##..#.......#....................#.............................................#...........\r\n..................#......#.............#.##.................................##.....................................#...#..........\r\n.#...##........#........................................................................................#.....#...#....#..........\r\n............#........................#............................................#.........#.............#.......................\r\n................#......#........#...........................................................#............#........................\r\n..............................#.#......#................................#...........#......................................#......\r\n...................#...................#.............#............#.............#.................................................\r\n.........#.......#....#........#.........#.....................#..#.......#..#...#.............................#..................\r\n.........#...#.........................................................................#.....#.......#............................\r\n.........................#..........#...............................................#.....................................#....#..\r\n....#..................##..##...........#.........#..................................................#...#...........#...........#\r\n.......#.......#.....#...............#.#.....#.............#........................#..............................#..#.........#.\r\n........................#........................................#.............................##.................................";

		private const char OBSTACLE = '#';
		private const char ENROUTE = 'X';
		private const int ZERO_OFFSET = -1;

		private enum Direction
		{
			N,
			E,
			S,
			W
		}

		[TestCase(Example, 5, 7, 41)]
		[TestCase(Data, 97, 42, 0)] // 1805 is wrong 3486 is too low
		public void QuestionA(string data, int startX, int startY, int expected)
		{
			// parse the lab into a (shudder) multi-dimensional array (shudder)
			// walk the guard through the lab one step at a time, following the rules:
			// - If there is something directly in front of you, turn right 90 degrees.
			// - Otherwise, take a step forward.
			// for each step, mark that element of the array with an X
			// until the path leaves the bounds of the array
			// then count the total number of elements having an X

			int solution = 0;

			string[] rows = data.Split("\r\n");
			char[,] grid = InitializeGrid(rows);
			PopulateGrid(grid, rows);

			Direction startingDirection = Direction.N;
			PredictPath(grid, startX, startY, startingDirection);
			foreach (var element in grid)
			{
				if (element == ENROUTE)
				{
					++solution;
				}
			}

			Console.WriteLine(solution);
			Assert.That(solution, Is.EqualTo(expected));
		}

		private static char[,] InitializeGrid(string[] data)
		{
			int rows = data.Length;
			int columns = data[0].Length;

			return new char[columns, rows];
		}

		private static void PopulateGrid(char[,] grid, string[] data)
		{
			for (int y = 0; y < data.Length; ++y)
			{
				for (int x = 0; x < data[0].Length; ++x)
				{
					grid[y, x] = data[y][x];
				}
			}
		}

		private static void PredictPath(char[,] grid, int x, int y, Direction direction)
		{
			int newX = x;
			int newY = y;
			Direction newDirection = direction;

			grid[newY + ZERO_OFFSET, newX + ZERO_OFFSET] = ENROUTE;
			//Console.WriteLine("{0},{1}", newX, newY);

			switch (direction)
			{
				case Direction.N:
					--newY;
					if (newY == 0) // I'm keep X and Y indexed to 1 to make it easy on my brain :D
					{
						return;
					}

					if (grid[newY + ZERO_OFFSET, newX + ZERO_OFFSET] == OBSTACLE)
					{
						++newY;
						newDirection = Direction.E;
						Console.WriteLine("Turn E at {0},{1}", newX, newY);
					}
					break;
				case Direction.E:
					++newX;
					if (newX > grid.GetLength(0)) // I'm keep X and Y indexed to 1 to make it easy on my brain :D
					{
						return;
					}

					if (grid[newY + ZERO_OFFSET, newX + ZERO_OFFSET] == OBSTACLE)
					{
						--newX;
						newDirection = Direction.S;
						Console.WriteLine("Turn S at {0},{1}", newX, newY);
					}
					break;
				case Direction.S:
					++newY;
					if (newY > grid.GetLength(1)) // I'm keep X and Y indexed to 1 to make it easy on my brain :D
					{
						return;
					}

					if (grid[newY + ZERO_OFFSET, newX + ZERO_OFFSET] == OBSTACLE)
					{
						--newY;
						newDirection = Direction.W;
						Console.WriteLine("Turn W at {0},{1}", newX, newY);
					}
					break;
				case Direction.W:
					--newX;
					if (newX == 0) // I'm keep X and Y indexed to 1 to make it easy on my brain :D
					{
						return;
					}

					if (grid[newY + ZERO_OFFSET, newX + ZERO_OFFSET] == OBSTACLE)
					{
						++newX;
						newDirection = Direction.N;
						Console.WriteLine("Turn N at {0},{1}", newX, newY);
					}
					break;
			}

			PredictPath(grid, newX, newY, newDirection);
		}

		[TestCase(Example, 5, 7, 41)]
		[TestCase(Data, 42, 98, 0), Ignore("Waiting for Example to pass before testing with puzzle input.")]
		public void QuestionB(string data, int startX, int startY, int expected)
		{
			int solution = 0;

			string[] rows = data.Split("\r\n");
			char[,] grid = InitializeGrid(rows);
			PopulateGrid(grid, rows);

			Console.WriteLine(solution);
			Assert.That(solution, Is.EqualTo(expected));
		}
	}
}